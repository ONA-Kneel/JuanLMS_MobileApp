"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DeviceStats = void 0;
var _videoReactBindings = require("@stream-io/video-react-bindings");
var _react = require("react");
var _videoClient = require("@stream-io/video-client");
var _reactNative = require("react-native");
const eventEmitter = _reactNative.NativeModules?.StreamVideoReactNative ? new _reactNative.NativeEventEmitter(_reactNative.NativeModules?.StreamVideoReactNative) : undefined;

/**
 * This is a renderless component to get the device stats like thermal state and power saver mode.
 */
const DeviceStats = () => {
  const {
    useCallCallingState
  } = (0, _videoReactBindings.useCallStateHooks)();
  const callingState = useCallCallingState();
  const call = (0, _videoReactBindings.useCall)();
  (0, _react.useEffect)(() => {
    if (!call || callingState !== _videoClient.CallingState.JOINED) return;
    _reactNative.NativeModules?.StreamVideoReactNative.isLowPowerModeEnabled().then(initialPowerMode => {
      (0, _videoClient.setPowerState)(initialPowerMode);
      call.tracer.trace('device.lowPowerMode', initialPowerMode);
    });
    const powerModeSubscription = eventEmitter?.addListener('isLowPowerModeEnabled', isLowPowerMode => {
      (0, _videoClient.setPowerState)(isLowPowerMode);
      call.tracer.trace('device.lowPowerMode', isLowPowerMode);
    });
    _reactNative.NativeModules?.StreamVideoReactNative.currentThermalState().then(initialState => {
      (0, _videoClient.setThermalState)(initialState);
      call.tracer.trace('device.thermalState', initialState);
    });
    const thermalStateSubscription = eventEmitter?.addListener('thermalStateDidChange', thermalState => {
      (0, _videoClient.setThermalState)(thermalState);
      call.tracer.trace('device.thermalStateChanged', thermalState);
    });

    // on android we need to explicitly start and stop the thermal status updates
    if (_reactNative.Platform.OS === 'android') {
      _reactNative.NativeModules?.StreamVideoReactNative.startThermalStatusUpdates();
    }
    return () => {
      powerModeSubscription?.remove();
      thermalStateSubscription?.remove();
      if (_reactNative.Platform.OS === 'android') {
        _reactNative.NativeModules?.StreamVideoReactNative.stopThermalStatusUpdates();
      }
    };
  }, [call, callingState]);
  return null;
};
exports.DeviceStats = DeviceStats;
//# sourceMappingURL=DeviceStats.js.map